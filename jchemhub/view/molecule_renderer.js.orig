goog.provide('jchemhub.view.MoleculeRenderer');
goog.require('jchemhub.controller.BondController');
goog.require('jchemhub.view.BondRenderer');
goog.require('jchemhub.view.BondRendererFactory');
goog.require('jchemhub.view.AtomRenderer');
goog.require('jchemhub.controller.AtomController');

/**
 * Class to render a molecule object to a graphics object
 * 
 * @constructor
 * @param graphics
 *            {goog.graphics.AbstractGraphics} graphics to draw on.
 * @extends {jchemhub.view.Renderer}
 */
jchemhub.view.MoleculeRenderer = function(controller, graphics, opt_config) {
	jchemhub.view.Renderer.call(this, controller, graphics, opt_config,
			jchemhub.view.MoleculeRenderer.defaultConfig);
	this.scale_factor = 1;
	this.bondController = new jchemhub.controller.BondController(controller);
	this.bondRendererFactory = new jchemhub.view.BondRendererFactory(
			this.bondController, graphics);
	this.atomController = new jchemhub.controller.AtomController(controller);
	this.atomRenderer = new jchemhub.view.AtomRenderer(this.atomController,
			graphics, opt_config);
}
goog.inherits(jchemhub.view.MoleculeRenderer, jchemhub.view.Renderer);

/**
 * The logger for this class.
 * 
 * @type {goog.debug.Logger}
 * @protected
 */
jchemhub.view.MoleculeRenderer.prototype.logger = goog.debug.Logger
		.getLogger('jchemhub.view.MoleculeRenderer');

jchemhub.view.MoleculeRenderer.prototype.render = function(molecule, trans) {
	var atom_coords = goog.array.map(molecule.atoms, function(a) {
		return a.coord;
	});
	var box = goog.math.Box.boundingBox.apply(null, atom_coords);

	if (!trans) {
		// if not part of a reaction, we need to create a transform
		var m = this.config.get("margin");
		var ex_box = box.expand(m.top, m.right, m.bottom, m.left);
		trans = this.getTransform(ex_box);
	}
	this.transform = trans;
	var center = new goog.math.Coordinate((box.left + box.right) / 2,
			(box.top + box.bottom) / 2);
	var t_center = this.transform.transformCoords( [ center ])[0];
	var rx = Math.abs(this.transform.getScaleX() * (box.right - box.left) / 2);
	var ry = Math.abs(this.transform.getScaleY() * (box.bottom - box.top) / 2);

<<<<<<< HEAD:jchemhub/view/molecule_renderer.js
	goog.array.forEach(molecule.bonds, function(bond) {
		this.bondRendererFactory.get(bond).render(bond, trans);
	}, this);

=======
	this.graphics.drawEllipse(t_center.x, t_center.y, rx, ry, stroke, fill,
			group);
	// this.logger.info("molecule has " + molecule.bonds.length + " bonds");
	
        var bondStroke = new goog.graphics.Stroke(2, 'black');
	var bondFill = null;
	var bondFill = new goog.graphics.SolidFill('black');



        var bondPath = new goog.graphics.Path();
	goog.array.forEach(molecule.bonds, function(bond) {
		this.bondRendererFactory.get(bond).render(bond, trans, bondPath);
	}, this);
	this.graphics.drawPath(bondPath, bondStroke, bondFill, group);
	
        
        
        
        // this.logger.info("molecule has " + molecule.atoms.length + " atoms");
>>>>>>> 1178db1798b4502392f2132049bdf03018f39b3f:jchemhub/view/molecule_renderer.js
	goog.array.forEach(molecule.atoms, function(atom) {
		this.atomRenderer.render(atom, trans);
	}, this);

}

/**
 * A default configuration for renderer
 */
jchemhub.view.MoleculeRenderer.defaultConfig = {
	margin : 4
};
